fn iteration(width : int, height : int, body : fn(int, int) -> void) -> void {
    let dim = (width, height, 1);
    let block = (128, 1, 1);

    cuda(1, dim, block, || -> void {
        let tid_x = threadIdx_x() + blockDim_x() * blockIdx_x();
        let tid_y = threadIdx_y() + blockDim_y() * blockIdx_y();

        body(tid_x, tid_y);
    });
}

fn iteration_advanced(width : int, height : int,
                      body : fn(int, int) -> void
                     ) -> void {
    let unroll = 1;
    let dim = (width, height/unroll, 1);
    let block = (128, 1, 1);

    cuda(1, dim, block, || -> void {
        let tid_x = threadIdx_x() + blockDim_x() * blockIdx_x();
        let tid_y = threadIdx_y() + blockDim_y() * blockIdx_y() * unroll;

        @iterate(0, unroll, |i : int| -> void {
            body(tid_x, tid_y + i * blockDim_y());
        });
    });
}

