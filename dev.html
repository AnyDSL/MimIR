<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MimIR: Developer Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-interactive-toc.js" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/anydsl/MimIR" class="github-corner" title="View source on GitHub">
    <svg viewBox="0 0 250 250" style="position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">MimIR<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">MimIR is my Intermediate Representation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dev.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Developer Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#autotoc_md17">Basics</a>
  </li>
  <li class="level1">
    <a href="#mut">Immutables vs. Mutables</a>
  </li>
  <li class="level1">
    <a href="#autotoc_md18">Matching IR</a>
    <ul>
      <li class="level2">
        <a href="#cast_builtin">Downcast for Built-ins</a>
        <ul>
          <li class="level3">
            <a href="#autotoc_md19">Downcast</a>
          </li>
          <li class="level3">
            <a href="#autotoc_md20">Downcast for Immutables</a>
          </li>
          <li class="level3">
            <a href="#autotoc_md21">Downcast for Mutables</a>
          </li>
          <li class="level3">
            <a href="#cast_lit">Matching Literals</a>
          </li>
          <li class="level3">
            <a href="#autotoc_md22">Summary</a>
          </li>
          <li class="level3">
            <a href="#autotoc_md23">Further Casts</a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#cast_axm">Matching Axioms</a>
        <ul>
          <li class="level3">
            <a href="#autotoc_md24">w/o Subtags</a>
          </li>
          <li class="level3">
            <a href="#autotoc_md25">w/ Subtags</a>
          </li>
          <li class="level3">
            <a href="#autotoc_md26">Summary</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#autotoc_md27">Working with Indices</a>
    <ul>
      <li class="level2">
        <a href="#autotoc_md28">Arity</a>
      </li>
      <li class="level2">
        <a href="#autotoc_md29">Proj</a>
        <ul>
          <li class="level3">
            <a href="#autotoc_md30">Thresholded Variants</a>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#autotoc_md31">Shape</a>
      </li>
      <li class="level2">
        <a href="#autotoc_md32">Summary</a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#autotoc_md33">Iterating over the Program</a>
  </li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_docs_2dev"></a></p>
<p>This guide summaries typical idioms you want to use when working with MimIR as a developer.</p>
<h1><a class="anchor" id="autotoc_md17"></a>
Basics</h1>
<p>Let's jump straight into an example. </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;fstream&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="driver_8h.html">mim/driver.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="parser_8h.html">mim/ast/parser.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="optimize_8h.html">mim/pass/optimize.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="sys_8h.html">mim/util/sys.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="mem_8h.html">mim/plug/mem/mem.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacemim.html">mim</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacemim_1_1plug.html">mim::plug</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="main_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>(<span class="keywordtype">int</span>, <span class="keywordtype">char</span>**) {</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <a class="code hl_class" href="classmim_1_1Driver.html">Driver</a> driver;</div>
<div class="line">        <span class="keyword">auto</span>&amp; w  = driver.<a class="code hl_function" href="classmim_1_1Driver.html#a6bb261071b0b8c994cf8dd9c90e78351">world</a>();</div>
<div class="line">        <span class="keyword">auto</span> <a class="code hl_namespace" href="namespacemim_1_1ast.html">ast</a> = <a class="code hl_class" href="classmim_1_1ast_1_1AST.html">ast::AST</a>(w);</div>
<div class="line">        driver.<a class="code hl_function" href="classmim_1_1Driver.html#a4ae595cd0560c10bd7fe6a392780b1f2">log</a>().<a class="code hl_function" href="classmim_1_1Log.html#a981c33b8d1500c0c4c595701d0bfd044">set</a>(&amp;std::cerr).<a class="code hl_function" href="classmim_1_1Log.html#a981c33b8d1500c0c4c595701d0bfd044">set</a>(<a class="code hl_enumvalue" href="classmim_1_1Log.html#aab4ab68f72a5d79c8acc1f1cf7c68590aa603905470e2a5b8c13e96b579ef0dba">Log::Level::Debug</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> parser = <a class="code hl_class" href="classmim_1_1ast_1_1Parser.html">ast::Parser</a>(<a class="code hl_namespace" href="namespacemim_1_1ast.html">ast</a>);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> plugin : {<span class="stringliteral">&quot;compile&quot;</span>, <span class="stringliteral">&quot;core&quot;</span>}) parser.plugin(plugin);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Cn [%mem.M, I32, %mem.Ptr (I32, 0) Cn [%mem.M, I32]]</span></div>
<div class="line">        <span class="keyword">auto</span> mem_t  = w.annex&lt;<a class="code hl_enumeration" href="namespacemim_1_1plug_1_1mem.html#a44127c99fa94a5143565463d65206ea6">mem::M</a>&gt;();</div>
<div class="line">        <span class="keyword">auto</span> argv_t = w.call&lt;<a class="code hl_enumeration" href="namespacemim_1_1plug_1_1mem.html#ace46b7b29a70a8a286dd0a1fc74855f3">mem::Ptr0</a>&gt;(w.call&lt;<a class="code hl_enumeration" href="namespacemim_1_1plug_1_1mem.html#ace46b7b29a70a8a286dd0a1fc74855f3">mem::Ptr0</a>&gt;(w.type_i32()));</div>
<div class="line">        <span class="keyword">auto</span> <a class="code hl_function" href="main_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>   = w.mut_fun({mem_t, w.type_i32(), argv_t}, {mem_t, <a class="code hl_enumvalue" href="namespacemim_1_1plug_1_1regex.html#af786f27f8eebb04e7543f565e8763938af1290186a5d0b1ceab27f4e77c0c5d68">w</a>.type_i32()})-&gt;<a class="code hl_enumvalue" href="namespacemim_1_1plug_1_1ord.html#af994f9a15f3bed1a74847bf1bc0160d3acdaeeeba9b4a4c5ebf042c0215a7bb0e">set</a>(<span class="stringliteral">&quot;main&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> [<a class="code hl_namespace" href="namespacemim_1_1plug_1_1mem.html">mem</a>, argc, argv, ret] = <a class="code hl_function" href="main_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>-&gt;vars&lt;4&gt;();</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>-&gt;app(<span class="keyword">false</span>, ret, {<a class="code hl_namespace" href="namespacemim_1_1plug_1_1mem.html">mem</a>, argc});</div>
<div class="line">        <a class="code hl_function" href="main_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a>-&gt;make_external();</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_function" href="namespacemim.html#a60ee93398f76269a406c841b2bb2c306">optimize</a>(w);</div>
<div class="line">        std::ofstream ofs(<span class="stringliteral">&quot;hello.ll&quot;</span>);</div>
<div class="line">        driver.<a class="code hl_function" href="classmim_1_1Driver.html#a41e5a945cac9fdfd37830a722b5bd2a4">backend</a>(<span class="stringliteral">&quot;ll&quot;</span>)(<a class="code hl_enumvalue" href="namespacemim_1_1plug_1_1regex.html#af786f27f8eebb04e7543f565e8763938af1290186a5d0b1ceab27f4e77c0c5d68">w</a>, ofs);</div>
<div class="line">        ofs.close(); <span class="comment">// make sure everything is written before clang is invoked</span></div>
<div class="line"> </div>
<div class="line">        <a class="code hl_function" href="namespacemim_1_1sys.html#a45bd42e13e6b59eacaf1bba01adda396">sys::system</a>(<span class="stringliteral">&quot;clang hello.ll -o hello -Wno-override-module&quot;</span>);</div>
<div class="line">        <a class="code hl_function" href="namespacemim.html#aa419224f30fc609b0b9cbe6aa4a67b8a">outln</a>(<span class="stringliteral">&quot;exit code: {}&quot;</span>, <a class="code hl_function" href="namespacemim_1_1sys.html#a45bd42e13e6b59eacaf1bba01adda396">sys::system</a>(<span class="stringliteral">&quot;./hello a b c&quot;</span>));</div>
<div class="line">    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div>
<div class="line">        <a class="code hl_function" href="namespacemim.html#acd5f271791887591d1b309592374ab49">errln</a>(<span class="stringliteral">&quot;{}&quot;</span>, <a class="code hl_enumvalue" href="namespacemim_1_1plug_1_1core.html#a4fd1e12f25215e48e67478a04191985eae1671797c52e15f763380b45e841ec32">e</a>.what());</div>
<div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">    } <span class="keywordflow">catch</span> (...) {</div>
<div class="line">        <a class="code hl_function" href="namespacemim.html#acd5f271791887591d1b309592374ab49">errln</a>(<span class="stringliteral">&quot;error: unknown exception&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> EXIT_FAILURE;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> EXIT_SUCCESS;</div>
<div class="line">}</div>
<div class="ttc" id="aclassmim_1_1Driver_html"><div class="ttname"><a href="classmim_1_1Driver.html">mim::Driver</a></div><div class="ttdoc">Some &quot;global&quot; variables needed all over the place.</div><div class="ttdef"><b>Definition</b> <a href="driver_8h_source.html#l00017">driver.h:17</a></div></div>
<div class="ttc" id="aclassmim_1_1Driver_html_a41e5a945cac9fdfd37830a722b5bd2a4"><div class="ttname"><a href="classmim_1_1Driver.html#a41e5a945cac9fdfd37830a722b5bd2a4">mim::Driver::backend</a></div><div class="ttdeci">auto backend(std::string_view name)</div><div class="ttdef"><b>Definition</b> <a href="driver_8h_source.html#l00078">driver.h:78</a></div></div>
<div class="ttc" id="aclassmim_1_1Driver_html_a4ae595cd0560c10bd7fe6a392780b1f2"><div class="ttname"><a href="classmim_1_1Driver.html#a4ae595cd0560c10bd7fe6a392780b1f2">mim::Driver::log</a></div><div class="ttdeci">Log &amp; log()</div><div class="ttdef"><b>Definition</b> <a href="driver_8h_source.html#l00024">driver.h:24</a></div></div>
<div class="ttc" id="aclassmim_1_1Driver_html_a6bb261071b0b8c994cf8dd9c90e78351"><div class="ttname"><a href="classmim_1_1Driver.html#a6bb261071b0b8c994cf8dd9c90e78351">mim::Driver::world</a></div><div class="ttdeci">World &amp; world()</div><div class="ttdef"><b>Definition</b> <a href="driver_8h_source.html#l00025">driver.h:25</a></div></div>
<div class="ttc" id="aclassmim_1_1Log_html_a981c33b8d1500c0c4c595701d0bfd044"><div class="ttname"><a href="classmim_1_1Log.html#a981c33b8d1500c0c4c595701d0bfd044">mim::Log::set</a></div><div class="ttdeci">Log &amp; set(std::ostream *ostream)</div><div class="ttdef"><b>Definition</b> <a href="log_8h_source.html#l00037">log.h:37</a></div></div>
<div class="ttc" id="aclassmim_1_1Log_html_aab4ab68f72a5d79c8acc1f1cf7c68590aa603905470e2a5b8c13e96b579ef0dba"><div class="ttname"><a href="classmim_1_1Log.html#aab4ab68f72a5d79c8acc1f1cf7c68590aa603905470e2a5b8c13e96b579ef0dba">mim::Log::Level::Debug</a></div><div class="ttdeci">@ Debug</div><div class="ttdef"><b>Definition</b> <a href="log_8h_source.html#l00022">log.h:22</a></div></div>
<div class="ttc" id="aclassmim_1_1ast_1_1AST_html"><div class="ttname"><a href="classmim_1_1ast_1_1AST.html">mim::ast::AST</a></div><div class="ttdef"><b>Definition</b> <a href="ast_8h_source.html#l00046">ast.h:46</a></div></div>
<div class="ttc" id="aclassmim_1_1ast_1_1Parser_html"><div class="ttname"><a href="classmim_1_1ast_1_1Parser.html">mim::ast::Parser</a></div><div class="ttdoc">Parses Mim code as AST.</div><div class="ttdef"><b>Definition</b> <a href="parser_8h_source.html#l00030">parser.h:30</a></div></div>
<div class="ttc" id="adriver_8h_html"><div class="ttname"><a href="driver_8h.html">driver.h</a></div></div>
<div class="ttc" id="amain_8cpp_html_a3c04138a5bfe5d72780bb7e82a18e627"><div class="ttname"><a href="main_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a></div><div class="ttdeci">int main(int argc, char **argv)</div><div class="ttdef"><b>Definition</b> <a href="main_8cpp_source.html#l00021">main.cpp:21</a></div></div>
<div class="ttc" id="amem_8h_html"><div class="ttname"><a href="mem_8h.html">mem.h</a></div></div>
<div class="ttc" id="anamespacemim_1_1ast_html"><div class="ttname"><a href="namespacemim_1_1ast.html">mim::ast</a></div><div class="ttdef"><b>Definition</b> <a href="ast_8h_source.html#l00014">ast.h:14</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_1_1core_html_a4fd1e12f25215e48e67478a04191985eae1671797c52e15f763380b45e841ec32"><div class="ttname"><a href="namespacemim_1_1plug_1_1core.html#a4fd1e12f25215e48e67478a04191985eae1671797c52e15f763380b45e841ec32">mim::plug::core::ncmp::e</a></div><div class="ttdeci">@ e</div><div class="ttdef"><b>Definition</b> <a href="core_2autogen_8h_source.html#l00031">autogen.h:31</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_1_1mem_html"><div class="ttname"><a href="namespacemim_1_1plug_1_1mem.html">mim::plug::mem</a></div><div class="ttdoc">The mem Plugin</div><div class="ttdef"><b>Definition</b> <a href="mem_8h_source.html#l00011">mem.h:11</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_1_1mem_html_a44127c99fa94a5143565463d65206ea6"><div class="ttname"><a href="namespacemim_1_1plug_1_1mem.html#a44127c99fa94a5143565463d65206ea6">mim::plug::mem::M</a></div><div class="ttdeci">M</div><div class="ttdef"><b>Definition</b> <a href="mem_2autogen_8h_source.html#l00014">autogen.h:14</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_1_1mem_html_ace46b7b29a70a8a286dd0a1fc74855f3"><div class="ttname"><a href="namespacemim_1_1plug_1_1mem.html#ace46b7b29a70a8a286dd0a1fc74855f3">mim::plug::mem::Ptr0</a></div><div class="ttdeci">Ptr0</div><div class="ttdef"><b>Definition</b> <a href="mem_2autogen_8h_source.html#l00028">autogen.h:28</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_1_1ord_html_af994f9a15f3bed1a74847bf1bc0160d3acdaeeeba9b4a4c5ebf042c0215a7bb0e"><div class="ttname"><a href="namespacemim_1_1plug_1_1ord.html#af994f9a15f3bed1a74847bf1bc0160d3acdaeeeba9b4a4c5ebf042c0215a7bb0e">mim::plug::ord::init::set</a></div><div class="ttdeci">@ set</div><div class="ttdef"><b>Definition</b> <a href="ord_2autogen_8h_source.html#l00036">autogen.h:36</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_1_1regex_html_af786f27f8eebb04e7543f565e8763938af1290186a5d0b1ceab27f4e77c0c5d68"><div class="ttname"><a href="namespacemim_1_1plug_1_1regex.html#af786f27f8eebb04e7543f565e8763938af1290186a5d0b1ceab27f4e77c0c5d68">mim::plug::regex::cls::w</a></div><div class="ttdeci">@ w</div><div class="ttdef"><b>Definition</b> <a href="regex_2autogen_8h_source.html#l00056">autogen.h:56</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_html"><div class="ttname"><a href="namespacemim_1_1plug.html">mim::plug</a></div><div class="ttdef"><b>Definition</b> <a href="lower__for_8h_source.html#l00007">lower_for.h:7</a></div></div>
<div class="ttc" id="anamespacemim_1_1sys_html_a45bd42e13e6b59eacaf1bba01adda396"><div class="ttname"><a href="namespacemim_1_1sys.html#a45bd42e13e6b59eacaf1bba01adda396">mim::sys::system</a></div><div class="ttdeci">int system(std::string)</div><div class="ttdoc">Wraps std::system and makes the return value usable.</div><div class="ttdef"><b>Definition</b> <a href="sys_8cpp_source.html#l00071">sys.cpp:71</a></div></div>
<div class="ttc" id="anamespacemim_html"><div class="ttname"><a href="namespacemim.html">mim</a></div><div class="ttdef"><b>Definition</b> <a href="ast_8h_source.html#l00014">ast.h:14</a></div></div>
<div class="ttc" id="anamespacemim_html_a60ee93398f76269a406c841b2bb2c306"><div class="ttname"><a href="namespacemim.html#a60ee93398f76269a406c841b2bb2c306">mim::optimize</a></div><div class="ttdeci">void optimize(World &amp;)</div><div class="ttdef"><b>Definition</b> <a href="optimize_8cpp_source.html#l00010">optimize.cpp:10</a></div></div>
<div class="ttc" id="anamespacemim_html_aa419224f30fc609b0b9cbe6aa4a67b8a"><div class="ttname"><a href="namespacemim.html#aa419224f30fc609b0b9cbe6aa4a67b8a">mim::outln</a></div><div class="ttdeci">std::ostream &amp; outln(const char *fmt, Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition</b> <a href="print_8h_source.html#l00190">print.h:190</a></div></div>
<div class="ttc" id="anamespacemim_html_acd5f271791887591d1b309592374ab49"><div class="ttname"><a href="namespacemim.html#acd5f271791887591d1b309592374ab49">mim::errln</a></div><div class="ttdeci">std::ostream &amp; errln(const char *fmt, Args &amp;&amp;... args)</div><div class="ttdef"><b>Definition</b> <a href="print_8h_source.html#l00191">print.h:191</a></div></div>
<div class="ttc" id="aoptimize_8h_html"><div class="ttname"><a href="optimize_8h.html">optimize.h</a></div></div>
<div class="ttc" id="aparser_8h_html"><div class="ttname"><a href="parser_8h.html">parser.h</a></div></div>
<div class="ttc" id="asys_8h_html"><div class="ttname"><a href="sys_8h.html">sys.h</a></div></div>
</div><!-- fragment --><p><a class="el" href="classmim_1_1Driver.html">Driver</a> is the first class that you want to allocate. It keeps track of a few "global" variables like some <a class="el" href="namespacemim.html#structmim_1_1Flags">Flags</a> or the <a class="el" href="classmim_1_1Log.html">Log</a>. Here, the log is set up to output to <code>std::cerr</code> with <a class="el" href="classmim_1_1Log.html#aab4ab68f72a5d79c8acc1f1cf7c68590aa603905470e2a5b8c13e96b579ef0dba">mim::Log::Level::Debug</a> (see also <a class="el" href="cli.html#clidebug">Debugging Features</a>).</p>
<p>Then, we load the plugins <a class="el" href="compile.html">compile</a> and <a class="el" href="core.html">core</a>, which in turn will load the plugin <a class="el" href="mem.html">mem</a>. A plugin consists of a shared object (<code>.so</code>/<code>.dll</code>) and a <code>.mim</code> file. The shared object contains <a class="el" href="classmim_1_1Pass.html">Passes</a>, <a class="el" href="classmim_1_1Axm.html#a86709d59d9d1dec24da36a52db1177f4">normalizers</a>, and so on. The <code>.mim</code> file contains the <a class="el" href="classmim_1_1Axm.html">axiom</a> declarations and links the normalizers with the <a class="el" href="classmim_1_1Axm.html">axioms</a>. For this reason, we need to allocate the <a class="el" href="classmim_1_1ast_1_1Parser.html" title="Parses Mim code as AST.">mim::ast::Parser</a> to parse the <code>.mim</code> file; <a class="el" href="classmim_1_1ast_1_1Parser.html#ae74335d89ab002052322c38655985523">mim::ast::Parser::plugin</a> will also load the shared object. The <a class="el" href="classmim_1_1Driver.html" title="Some &quot;global&quot; variables needed all over the place.">mim::Driver</a> keeps track of all plugins.</p>
<p>Next, we create actual code. <a class="el" href="classmim_1_1Def.html">Def</a> is the base class for <b>all</b> nodes/expressions in MimIR. Each <a class="el" href="classmim_1_1Def.html">Def</a> is a node in a graph which is maintained in the <a class="el" href="classmim_1_1World.html">World</a>. The <a class="el" href="classmim_1_1World.html">World</a> is essentially a big hash set where all <a class="el" href="classmim_1_1Def.html">Defs</a> are tossed into. The <a class="el" href="classmim_1_1World.html">World</a> provides factory methods to create all kind of different <a class="el" href="classmim_1_1Def.html">Defs</a>. Here, we create the <code>main</code> function. In direct style, its type looks like this:</p>
<div class="fragment"><div class="line">[%mem.M, I32, %mem.Ptr (I32, 0)] -&gt; [%mem.M, I32]]</div>
</div><!-- fragment --><p>Converted to <a href="https://en.wikipedia.org/wiki/Continuation-passing_style">continuation-passing style (CPS)</a> this type looks like this:</p>
<div class="fragment"><div class="line">Cn [%mem.M, I32, %mem.Ptr (I32, 0), Cn [%mem.M, I32]]</div>
</div><!-- fragment --><p>The <code>%mem.M</code> type is a type that keeps track of side effects that may occur. Since, <code>main</code> introduces <a class="el" href="classmim_1_1Var.html">Var</a>iables we must create a <b>mutable</b> <a class="el" href="classmim_1_1Lam.html">Lam</a>bda (see <a class="el" href="#mut">Immutables vs. Mutables</a>). The only thing <code>main</code> is doing, is to invoke its <code>ret</code>urn continuation with <code>mem</code> and <code>argc</code> as argument:</p>
<div class="fragment"><div class="line">ret (mem, argc)</div>
</div><!-- fragment --><p>It is also important to make <code>main</code> <a class="el" href="classmim_1_1Def.html#a40fa93a786143fbf727f567b3c875101">external</a>. Otherwise, MimIR will simply remove this function.</p>
<p>We <a class="el" href="namespacemim.html#a60ee93398f76269a406c841b2bb2c306">optimize</a> the program, emit an <a href="https://llvm.org/docs/LangRef.html">LLVM assembly file</a>, and compile it <a class="el" href="namespacemim_1_1sys.html#a45bd42e13e6b59eacaf1bba01adda396">via</a> <code>clang</code>. Finally, we <a class="el" href="namespacemim_1_1sys.html#a45bd42e13e6b59eacaf1bba01adda396">execute</a> the generated program with <code>./hello a b c</code> and <a class="el" href="namespacemim.html#fmt">output</a> its exit code - which should be <code>4</code>.</p>
<h1><a class="anchor" id="mut"></a>
Immutables vs. Mutables</h1>
<p>There are two different kind of <a class="el" href="classmim_1_1Def.html">Defs</a> in MimIR: <em>mutables</em> and <em>immutables</em>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><b>Immutable</b>   </th><th class="markdownTableHeadNone"><b>Mutable</b>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><em>must be</em> <code>const</code>   </td><td class="markdownTableBodyNone"><em>may be</em> <b>non</b>-<code>const</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">ops form <a href="https://en.wikipedia.org/wiki/Directed_acyclic_graph">DAG</a>   </td><td class="markdownTableBodyNone">ops may be cyclic    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">no recursion   </td><td class="markdownTableBodyNone">may be recursive    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">no <a class="el" href="classmim_1_1Var.html">Var</a>   </td><td class="markdownTableBodyNone">may have <a class="el" href="classmim_1_1Var.html">Var</a>; get with <a class="el" href="classmim_1_1Def.html#a6e757a3ae8e52ee5b9ebdaea32c6abd8">mim::Def::var</a> / <a class="el" href="classmim_1_1Def.html#af82f20111e9f1cbdbf910d30341bd4ee" title="Only returns not nullptr, if Var of this mutable has ever been created.">mim::Def::has_var</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">build ops first, then the actual node   </td><td class="markdownTableBodyNone">build the actual node first, then <a class="el" href="classmim_1_1Def.html#a1164a26b23818879edfa4e6b9fe41d97">set</a> the ops    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><a href="https://en.wikipedia.org/wiki/Hash_consing">Hash consed</a>   </td><td class="markdownTableBodyNone">each new instance is fresh    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Def.html#aa620bd9f4f38559ce1863300acc92ca2">Def::rebuild</a>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Def.html#af09d5f11c586c2dd9c9c27597540837a">Def::stub</a>   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md18"></a>
Matching IR</h1>
<p>MimIR provides different means to scrutinize <a class="el" href="classmim_1_1Def.html">Defs</a>. Matching built-ins, i.e. all subclasses of <a class="el" href="classmim_1_1Def.html">Def</a>, works slightly differently than matching <a class="el" href="classmim_1_1Axm.html">Axioms</a>.</p>
<h2><a class="anchor" id="cast_builtin"></a>
Downcast for Built-ins</h2>
<p>Methods beginning with</p>
<ul>
<li><code>isa</code> work like a <code>dynamic_cast</code> with a runtime check and return <code>nullptr</code> if the cast is not possible, while</li>
<li>those beginning with <code>as</code> are more like a <code>static_cast</code> and <code>assert</code> via its <code>isa</code> sibling in the <code>Debug</code> build that the cast is correct.</li>
</ul>
<h3><a class="anchor" id="autotoc_md19"></a>
Downcast</h3>
<p><code>Def::isa</code>/<code>Def::as</code> allows for an <em>downcast</em> that matches both <em>mutables</em> and <em>immutables</em>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keyword">const</span> <a class="code hl_class" href="classmim_1_1Def.html">Def</a>* def) {</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> sigma = def-&gt;isa&lt;<a class="code hl_class" href="classmim_1_1Sigma.html">Sigma</a>&gt;()) {</div>
<div class="line">        <span class="comment">// sigma is of type &quot;const Sigma*&quot; and could be a mutable or an immutable</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// sigma of type &quot;const Sigma*&quot; and could be an immutable or a mutable</span></div>
<div class="line">    <span class="comment">// asserts, if def is not a Sigma</span></div>
<div class="line">    <span class="keyword">auto</span> sigma = def-&gt;<a class="code hl_function" href="classmim_1_1Def.html#ac62b72371d95ea3e8774d11336ed640b">as_imm</a>&lt;<a class="code hl_class" href="classmim_1_1Sigma.html">Sigma</a>&gt;();</div>
<div class="line">}</div>
<div class="ttc" id="aclassmim_1_1Def_html"><div class="ttname"><a href="classmim_1_1Def.html">mim::Def</a></div><div class="ttdoc">Base class for all Defs.</div><div class="ttdef"><b>Definition</b> <a href="def_8h_source.html#l00200">def.h:200</a></div></div>
<div class="ttc" id="aclassmim_1_1Def_html_ac62b72371d95ea3e8774d11336ed640b"><div class="ttname"><a href="classmim_1_1Def.html#ac62b72371d95ea3e8774d11336ed640b">mim::Def::as_imm</a></div><div class="ttdeci">const T * as_imm() const</div><div class="ttdef"><b>Definition</b> <a href="def_8h_source.html#l00427">def.h:427</a></div></div>
<div class="ttc" id="aclassmim_1_1Sigma_html"><div class="ttname"><a href="classmim_1_1Sigma.html">mim::Sigma</a></div><div class="ttdoc">A dependent tuple type.</div><div class="ttdef"><b>Definition</b> <a href="tuple_8h_source.html#l00015">tuple.h:15</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md20"></a>
Downcast for Immutables</h3>
<p><a class="el" href="classmim_1_1Def.html#ae95966891b117e5f8bf7f4bca7b95c64">mim::Def::isa_imm</a> / <a class="el" href="classmim_1_1Def.html#ac62b72371d95ea3e8774d11336ed640b">mim::Def::as_imm</a> allows for an <em>downcast</em> and <b>only</b> matches <em>immutables</em>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keyword">const</span> <a class="code hl_class" href="classmim_1_1Def.html">Def</a>* def) {</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> imm = def-&gt;<a class="code hl_function" href="classmim_1_1Def.html#ae95966891b117e5f8bf7f4bca7b95c64">isa_imm</a>()) {</div>
<div class="line">        <span class="comment">// imm of type &quot;const Def*&quot; and is an immutable</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> sigma = def-&gt;<a class="code hl_function" href="classmim_1_1Def.html#ae95966891b117e5f8bf7f4bca7b95c64">isa_imm</a>&lt;<a class="code hl_class" href="classmim_1_1Sigma.html">Sigma</a>&gt;()) {</div>
<div class="line">        <span class="comment">// sigma is of type &quot;const Sigma*&quot; and is an immutable Sigma</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// sigma of type &quot;const Sigma*&quot; and *must* be an immutable Sigma - otherwise, asserts</span></div>
<div class="line">    <span class="keyword">auto</span> sigma = def-&gt;<a class="code hl_function" href="classmim_1_1Def.html#ac62b72371d95ea3e8774d11336ed640b">as_imm</a>&lt;<a class="code hl_class" href="classmim_1_1Sigma.html">Sigma</a>&gt;();</div>
<div class="line">}</div>
<div class="ttc" id="aclassmim_1_1Def_html_ae95966891b117e5f8bf7f4bca7b95c64"><div class="ttname"><a href="classmim_1_1Def.html#ae95966891b117e5f8bf7f4bca7b95c64">mim::Def::isa_imm</a></div><div class="ttdeci">const T * isa_imm() const</div><div class="ttdef"><b>Definition</b> <a href="def_8h_source.html#l00426">def.h:426</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md21"></a>
Downcast for Mutables</h3>
<p><a class="el" href="classmim_1_1Def.html#a53a70702795d9c4bafe6de0d4f4a66f1" title="If this is mutable, it will cast constness away and perform a dynamic_cast to T.">mim::Def::isa_mut</a> / <a class="el" href="classmim_1_1Def.html#a18c97ca601e090eed9bcbc9369c2c792" title="Asserts that this is a mutable, casts constness away and performs a static_cast to T.">mim::Def::as_mut</a> allows for an <em>downcast</em> and <b>only</b> matches <em>mutables</em>. By doing so, it removes the <code>const</code> qualifier and gives you access to the <b>non</b>-<code>const</code> methods that only make sense for <em>mutables</em>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keyword">const</span> <a class="code hl_class" href="classmim_1_1Def.html">Def</a>* def) {</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> mut = def-&gt;<a class="code hl_function" href="classmim_1_1Def.html#a53a70702795d9c4bafe6de0d4f4a66f1">isa_mut</a>()) {</div>
<div class="line">        <span class="comment">// mut of type &quot;Def*&quot; - &quot;const&quot; has been removed!</span></div>
<div class="line">        <span class="comment">// This gives you access to the non-const methods:</span></div>
<div class="line">        <span class="keyword">auto</span> var = mut-&gt;var();</div>
<div class="line">        <span class="keyword">auto</span> stub = mut-&gt;stub(world, type, debug)</div>
<div class="line">        <span class="comment">// ...</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> lam = def-&gt;<a class="code hl_function" href="classmim_1_1Def.html#a53a70702795d9c4bafe6de0d4f4a66f1">isa_mut</a>&lt;<a class="code hl_class" href="classmim_1_1Lam.html">Lam</a>&gt;()) {</div>
<div class="line">        <span class="comment">// lam of type &quot;Lam*&quot; - &quot;const&quot; has been removed!</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// lam of type &quot;Lam*&quot; and *must* be a mutable Lam.</span></div>
<div class="line">    <span class="comment">// Otherwise, an assert will fire.</span></div>
<div class="line">    <span class="keyword">auto</span> lam = def-&gt;as&lt;<a class="code hl_class" href="classmim_1_1Lam.html">Lam</a>&gt;();</div>
<div class="line">}</div>
<div class="ttc" id="aclassmim_1_1Def_html_a53a70702795d9c4bafe6de0d4f4a66f1"><div class="ttname"><a href="classmim_1_1Def.html#a53a70702795d9c4bafe6de0d4f4a66f1">mim::Def::isa_mut</a></div><div class="ttdeci">T * isa_mut() const</div><div class="ttdoc">If this is mutable, it will cast constness away and perform a dynamic_cast to T.</div><div class="ttdef"><b>Definition</b> <a href="def_8h_source.html#l00431">def.h:431</a></div></div>
<div class="ttc" id="aclassmim_1_1Lam_html"><div class="ttname"><a href="classmim_1_1Lam.html">mim::Lam</a></div><div class="ttdoc">A function.</div><div class="ttdef"><b>Definition</b> <a href="lam_8h_source.html#l00106">lam.h:106</a></div></div>
</div><!-- fragment --><p>Checking via <code>Def::isa</code>/<code>Def::as</code> a <code>Def*</code> has the same effect as using <a class="el" href="classmim_1_1Def.html#a53a70702795d9c4bafe6de0d4f4a66f1" title="If this is mutable, it will cast constness away and perform a dynamic_cast to T.">mim::Def::isa_mut</a> / <a class="el" href="classmim_1_1Def.html#a18c97ca601e090eed9bcbc9369c2c792" title="Asserts that this is a mutable, casts constness away and performs a static_cast to T.">mim::Def::as_mut</a> since the scrutinee must be already a <em>mutable</em> due to the lack of the <code>const</code> qualifier:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<a class="code hl_class" href="classmim_1_1Def.html">Def</a>* def) { <span class="comment">// note the lack of &quot;const&quot; here</span></div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> sigma = def-&gt;isa&lt;<a class="code hl_class" href="classmim_1_1Sigma.html">Sigma</a>&gt;()) {</div>
<div class="line">        <span class="comment">// sigma is of type Sigma* and is a mutable</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> sigma = def-&gt;<a class="code hl_function" href="classmim_1_1Def.html#a53a70702795d9c4bafe6de0d4f4a66f1">isa_mut</a>&lt;<a class="code hl_class" href="classmim_1_1Sigma.html">Sigma</a>&gt;()) {</div>
<div class="line">        <span class="comment">// sigma is of type Sigma* and is a mutable</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// sigma of type &quot;Sigma*&quot; and is a mutable - otherwise, asserts</span></div>
<div class="line">    <span class="keyword">auto</span> sigma = def-&gt;as&lt;<a class="code hl_class" href="classmim_1_1Sigma.html">Sigma</a>&gt;();</div>
<div class="line">}</div>
</div><!-- fragment --><h3><a class="anchor" id="cast_lit"></a>
Matching Literals</h3>
<p>Often, you want to match a <a class="el" href="classmim_1_1Lit.html">Lit</a>eral and grab its content. You can use <a class="el" href="classmim_1_1Lit.html#a429b15b3da51e9b60ffab09a744896b7">Lit::isa</a>/<a class="el" href="classmim_1_1Lit.html#a95a167621043b56d131ebe4481b5d523">Lit::as</a> for this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keyword">const</span> <a class="code hl_class" href="classmim_1_1Def.html">Def</a>* def) {</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> lit = <a class="code hl_function" href="classmim_1_1Lit.html#a429b15b3da51e9b60ffab09a744896b7">Lit::isa</a>(def)) {</div>
<div class="line">        <span class="comment">// lit is of type &quot;std::optional&lt;u64&gt;&quot;</span></div>
<div class="line">        <span class="comment">// It&#39;s your responsibility that the grabbed value makes sense as u64.</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> lit = <a class="code hl_function" href="classmim_1_1Lit.html#a429b15b3da51e9b60ffab09a744896b7">Lit::isa&lt;f32&gt;</a>(def)) {</div>
<div class="line">        <span class="comment">// lit is of type &quot;std::optional&lt;f32&gt;&quot;</span></div>
<div class="line">        <span class="comment">// It&#39;s your responsibility that the grabbed value makes sense as f32.</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// asserts if def is not a Lit.</span></div>
<div class="line">    <span class="keyword">auto</span> lu64 = <a class="code hl_function" href="classmim_1_1Lit.html#a95a167621043b56d131ebe4481b5d523">Lit::as</a>(def);</div>
<div class="line">    <span class="keyword">auto</span> lf32 = <a class="code hl_function" href="classmim_1_1Lit.html#a95a167621043b56d131ebe4481b5d523">Lit::as&lt;f32&gt;</a>(def);</div>
<div class="line">}</div>
<div class="ttc" id="aclassmim_1_1Lit_html_a429b15b3da51e9b60ffab09a744896b7"><div class="ttname"><a href="classmim_1_1Lit.html#a429b15b3da51e9b60ffab09a744896b7">mim::Lit::isa</a></div><div class="ttdeci">static std::optional&lt; T &gt; isa(const Def *def)</div><div class="ttdef"><b>Definition</b> <a href="def_8h_source.html#l00737">def.h:737</a></div></div>
<div class="ttc" id="aclassmim_1_1Lit_html_a95a167621043b56d131ebe4481b5d523"><div class="ttname"><a href="classmim_1_1Lit.html#a95a167621043b56d131ebe4481b5d523">mim::Lit::as</a></div><div class="ttdeci">static T as(const Def *def)</div><div class="ttdef"><b>Definition</b> <a href="def_8h_source.html#l00742">def.h:742</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md22"></a>
Summary</h3>
<p>The following table summarizes all important casts:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><code>dynamic_cast</code> <br  />
 <code>static_cast</code>   </th><th class="markdownTableHeadNone">Returns   </th><th class="markdownTableHeadNone">If <code>def</code> is a ...    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>def-&gt;isa&lt;Lam&gt;()</code> <br  />
 <code>def-&gt;as&lt;Lam&gt;()</code>   </td><td class="markdownTableBodyNone"><code>const Lam*</code>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Lam.html">Lam</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>def-&gt;isa_imm&lt;Lam&gt;()</code> <br  />
 <code>def-&gt;as_imm&lt;Lam&gt;()</code>   </td><td class="markdownTableBodyNone"><code>const Lam*</code>   </td><td class="markdownTableBodyNone"><b>immutable</b> <a class="el" href="classmim_1_1Lam.html">Lam</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>def-&gt;isa_mut&lt;Lam&gt;()</code> <br  />
 <code>def-&gt;as_mut&lt;Lam&gt;()</code>   </td><td class="markdownTableBodyNone"><code>Lam*</code>   </td><td class="markdownTableBodyNone"><b>mutable</b> <a class="el" href="classmim_1_1Lam.html">Lam</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>Lit::isa(def)</code> <br  />
 <code>Lit::as(def)</code>   </td><td class="markdownTableBodyNone"><a href="https://en.cppreference.com/w/cpp/utility/optional">std::optional</a><code>&lt;</code><a class="el" href="namespacemim.html#a02aae51c2293663cb7352f21c7fbe490">nat_t</a><code>&gt;</code> <br  />
 <a class="el" href="namespacemim.html#a02aae51c2293663cb7352f21c7fbe490">nat_t</a>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Lit.html">Lit</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>Lit::isa&lt;f32&gt;(def)</code> <br  />
 <code>Lit::as&lt;f32&gt;(def)</code>   </td><td class="markdownTableBodyNone"><a href="https://en.cppreference.com/w/cpp/utility/optional">std::optional</a><code>&lt;</code><a class="el" href="namespacemim.html#a82b4995bab86fa95f954caf7b4805764">f32</a><code>&gt;</code> <br  />
 <a class="el" href="namespacemim.html#a82b4995bab86fa95f954caf7b4805764">f32</a>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Lit.html">Lit</a>   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md23"></a>
Further Casts</h3>
<p>There are also some additional checks available that usually come as <code>static</code> methods and either return a pointer to the checked entity or <code>nullptr</code>. Here are some examples:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keyword">const</span> <a class="code hl_class" href="classmim_1_1Def.html">Def</a>* def) {</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> size = <a class="code hl_function" href="classmim_1_1Idx.html#a7b4496e71deaa94835f732de364e5d76">Idx::isa</a>(def)) {</div>
<div class="line">        <span class="comment">// def = Idx size</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> lam = <a class="code hl_function" href="classmim_1_1Lam.html#adab8c4822338fe32fb4a7711b7d479c0">Lam::isa_mut_cn</a>(def)) {</div>
<div class="line">        <span class="comment">// def isa mutable Lam of type Cn T</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> pi = <a class="code hl_function" href="classmim_1_1Pi.html#a6b21a83dcd04211ce2bf6c3770d64919">Pi::isa_basicblock</a>(def)) {</div>
<div class="line">        <span class="comment">// def is a Pi whose co-domain is bottom and which is not returning</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassmim_1_1Idx_html_a7b4496e71deaa94835f732de364e5d76"><div class="ttname"><a href="classmim_1_1Idx.html#a7b4496e71deaa94835f732de364e5d76">mim::Idx::isa</a></div><div class="ttdeci">static const Def * isa(const Def *def)</div><div class="ttdoc">Checks if def is a Idx s and returns s or nullptr otherwise.</div><div class="ttdef"><b>Definition</b> <a href="def_8cpp_source.html#l00532">def.cpp:532</a></div></div>
<div class="ttc" id="aclassmim_1_1Lam_html_adab8c4822338fe32fb4a7711b7d479c0"><div class="ttname"><a href="classmim_1_1Lam.html#adab8c4822338fe32fb4a7711b7d479c0">mim::Lam::isa_mut_cn</a></div><div class="ttdeci">static Lam * isa_mut_cn(const Def *d)</div><div class="ttdoc">Only for mutables.</div><div class="ttdef"><b>Definition</b> <a href="lam_8h_source.html#l00140">lam.h:140</a></div></div>
<div class="ttc" id="aclassmim_1_1Pi_html_a6b21a83dcd04211ce2bf6c3770d64919"><div class="ttname"><a href="classmim_1_1Pi.html#a6b21a83dcd04211ce2bf6c3770d64919">mim::Pi::isa_basicblock</a></div><div class="ttdeci">static const Pi * isa_basicblock(const Def *d)</div><div class="ttdoc">Is this a continuation (Pi::isa_cn) that is not Pi::isa_returning?</div><div class="ttdef"><b>Definition</b> <a href="lam_8h_source.html#l00048">lam.h:48</a></div></div>
</div><!-- fragment --><h2><a class="anchor" id="cast_axm"></a>
Matching Axioms</h2>
<p>You can match <a class="el" href="classmim_1_1Axm.html">Axioms</a> via</p>
<ul>
<li><a class="el" href="classmim_1_1Axm.html#a877535f1d66f92f61585f323b1b986f1">mim::Axm::isa</a> which is again similar to a <code>dynamic_cast</code> with a runtime check and returns <a class="el" href="classmim_1_1Axm_1_1IsA.html#af7e49b22ba96454bf3d28462e052a437">a wrapped</a> <code>nullptr</code> (see below), if the cast is not possible, or</li>
<li><a class="el" href="classmim_1_1Axm.html#ae8e87ce6a825b04d1f8ef741392cf353">mim::Axm::as</a> which is again more like a <code>static_cast</code> and <code>assert</code>s via its <a class="el" href="classmim_1_1Axm.html#a877535f1d66f92f61585f323b1b986f1">mim::Axm::isa</a> sibling in the <code>Debug</code> build that the cast is correct.</li>
</ul>
<p>This will yield a <a class="el" href="classmim_1_1Axm_1_1IsA.html">mim::Axm::IsA</a><code>&lt;Id, D&gt;</code> which just wraps a <code>const D*</code>. <code>Id</code> is the <code>enum</code> of the corresponding <code>tag</code> of the <a class="el" href="classmim_1_1Axm.html#anatomy">matched Axiom</a>. Usually, <code>D</code> will be an <a class="el" href="classmim_1_1App.html">App</a> because most <a class="el" href="classmim_1_1Axm.html">Axioms</a> inhabit a <a class="el" href="classmim_1_1Pi.html">function type</a>. Otherwise, it may wrap a <a class="el" href="classmim_1_1Def.html">Def</a> or other subclasses of it. For instance, <a class="el" href="classmim_1_1Axm.html#a877535f1d66f92f61585f323b1b986f1">matching</a> <code>%mem.M</code> yields <a class="el" href="classmim_1_1Axm_1_1IsA.html">mim::Axm::IsA</a><code>&lt;</code><a class="el" href="namespacemim_1_1plug_1_1mem.html#a44127c99fa94a5143565463d65206ea6">mem::M</a>, <a class="el" href="classmim_1_1Def.html">Def</a><code>&gt;</code>.</p>
<p>By default, MimIR assumes that the magic of an <a class="el" href="classmim_1_1Axm.html">Axiom</a> happens when applying the final argument to a curried <a class="el" href="classmim_1_1Axm.html">Axiom</a>. For example, <a class="el" href="classmim_1_1Axm.html#a877535f1d66f92f61585f323b1b986f1">matching</a> a <code>%mem.load</code> will only trigger for the final <a class="el" href="classmim_1_1App.html">App</a> of the curried call</p>
<div class="fragment"><div class="line">%mem.load (T, as) (mem, ptr)</div>
</div><!-- fragment --><p>while</p>
<div class="fragment"><div class="line">%mem.load (T, as)</div>
</div><!-- fragment --><p>will <b>not</b> match. The wrapped <a class="el" href="classmim_1_1App.html">mim::App</a> inside the <a class="el" href="classmim_1_1Axm_1_1IsA.html">mim::Axm::IsA</a> refers to the last <a class="el" href="classmim_1_1App.html">mim::App</a> of the curried call. So in this example</p>
<ul>
<li><a class="el" href="classmim_1_1App.html#adf118f16568ef138e33bdb1f330112d1">mim::App::arg()</a> is <code>(mem, ptr)</code> and</li>
<li><p class="startli"><a class="el" href="classmim_1_1App.html#a9df7e6baae6a143ed3af2bc7ec643641">mim::App::callee()</a> is <code>%mem.load (T, as)</code>.</p>
<p class="startli">Use <a class="el" href="classmim_1_1App.html#a7683660e8ed01ddc495f8859393b720e" title="Returns App::callee again as App.">mim::App::decurry()</a> to directly get the <a class="el" href="classmim_1_1App.html#a9df7e6baae6a143ed3af2bc7ec643641">mim::App::callee()</a> as <a class="el" href="classmim_1_1App.html">mim::App</a>. See below for an example.</p>
</li>
</ul>
<p>If you want to design an <a class="el" href="classmim_1_1Axm.html">Axiom</a> that returns a function, you can <a class="el" href="classmim_1_1Axm.html#normalization">fine-adjust the trigger point</a> of a <a class="el" href="classmim_1_1Axm.html#a877535f1d66f92f61585f323b1b986f1">mim::Axm::isa</a> / <a class="el" href="classmim_1_1Axm.html#ae8e87ce6a825b04d1f8ef741392cf353">mim::Axm::as</a>.</p>
<h3><a class="anchor" id="autotoc_md24"></a>
w/o Subtags</h3>
<p>In order to match an <a class="el" href="classmim_1_1Axm.html">Axiom</a> <b>without</b> any subtags like <code>%mem.load</code>, do this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keyword">const</span> <a class="code hl_class" href="classmim_1_1Def.html">Def</a>* def) {</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> load = <a class="code hl_function" href="classmim_1_1Axm.html#a877535f1d66f92f61585f323b1b986f1">Axm::isa&lt;mem::load&gt;</a>(def)) {</div>
<div class="line">        <span class="keyword">auto</span> [<a class="code hl_namespace" href="namespacemim_1_1plug_1_1mem.html">mem</a>, ptr]            = load-&gt;args&lt;2&gt;();</div>
<div class="line">        <span class="keyword">auto</span> [pointee, addr_space] = load-&gt;decurry()-&gt;args&lt;2&gt;();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// def must match as a mem::load - otherwise, asserts</span></div>
<div class="line">    <span class="keyword">auto</span> load = <a class="code hl_function" href="classmim_1_1Axm.html#ae8e87ce6a825b04d1f8ef741392cf353">Axm::as&lt;mem::load&gt;</a>(def);</div>
<div class="line">}</div>
<div class="ttc" id="aclassmim_1_1Axm_html_a877535f1d66f92f61585f323b1b986f1"><div class="ttname"><a href="classmim_1_1Axm.html#a877535f1d66f92f61585f323b1b986f1">mim::Axm::isa</a></div><div class="ttdeci">static auto isa(const Def *def)</div><div class="ttdef"><b>Definition</b> <a href="axm_8h_source.html#l00104">axm.h:104</a></div></div>
<div class="ttc" id="aclassmim_1_1Axm_html_ae8e87ce6a825b04d1f8ef741392cf353"><div class="ttname"><a href="classmim_1_1Axm.html#ae8e87ce6a825b04d1f8ef741392cf353">mim::Axm::as</a></div><div class="ttdeci">static auto as(const Def *def)</div><div class="ttdef"><b>Definition</b> <a href="axm_8h_source.html#l00125">axm.h:125</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md25"></a>
w/ Subtags</h3>
<p>In order to match an <a class="el" href="classmim_1_1Axm.html">Axiom</a> <b>with</b> subtags like <code>%core.wrap</code>, do this:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> foo(<span class="keyword">const</span> <a class="code hl_class" href="classmim_1_1Def.html">Def</a>* def) {</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> wrap = <a class="code hl_function" href="classmim_1_1Axm.html#a877535f1d66f92f61585f323b1b986f1">Axm::isa&lt;core::wrap&gt;</a>(def)) {</div>
<div class="line">        <span class="keyword">auto</span> [a, b] = wrap-&gt;args&lt;2&gt;();</div>
<div class="line">        <span class="keyword">auto</span> mode   = wrap-&gt;decurry()-&gt;arg();</div>
<div class="line">        <span class="keywordflow">switch</span> (wrap.id()) {</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacemim_1_1plug_1_1core.html#a0d0bff4d75f3e06365643c56fd4672efa34ec78fcc91ffb1e54cd85e4a0924332">core::wrap::add</a>: <span class="comment">// ...</span></div>
<div class="line">            <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacemim_1_1plug_1_1core.html#a0d0bff4d75f3e06365643c56fd4672efa8a68dc3e925eacf92633be230722a140">core::wrap::sub</a>: <span class="comment">// ...</span></div>
<div class="line">            <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacemim_1_1plug_1_1core.html#a0d0bff4d75f3e06365643c56fd4672efa353942263d1bedfbe06b7bfa78226253">core::wrap::mul</a>: <span class="comment">// ...</span></div>
<div class="line">            <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="namespacemim_1_1plug_1_1core.html#a0d0bff4d75f3e06365643c56fd4672efabc192716b0e1d5c96a67961dd0d3f9da">core::wrap::shl</a>: <span class="comment">// ...</span></div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> add = <a class="code hl_function" href="classmim_1_1Axm.html#a877535f1d66f92f61585f323b1b986f1">Axm::isa</a>(<a class="code hl_enumvalue" href="namespacemim_1_1plug_1_1core.html#a0d0bff4d75f3e06365643c56fd4672efa34ec78fcc91ffb1e54cd85e4a0924332">core::wrap::add</a>, def)) {</div>
<div class="line">        <span class="keyword">auto</span> [<a class="code hl_enumvalue" href="namespacemim_1_1plug_1_1core.html#aa277dfbcc34fa69c6e62d136815f3e43a0cc175b9c0f1b6a831c399e269772661">a</a>, b] = <a class="code hl_enumeration" href="namespacemim_1_1plug_1_1autodiff.html#adec076a151d709a29626cbe2a3c20337">add</a>-&gt;args&lt;2&gt;();</div>
<div class="line">        <span class="keyword">auto</span> <a class="code hl_enumeration" href="namespacemim_1_1plug_1_1core.html#a24bcda8cb32531a8a5b3d5ab6d6c707e">mode</a>   = <a class="code hl_enumeration" href="namespacemim_1_1plug_1_1autodiff.html#adec076a151d709a29626cbe2a3c20337">add</a>-&gt;decurry()-&gt;arg();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// def must match as a core::wrap - otherwise, asserts</span></div>
<div class="line">    <span class="keyword">auto</span> <a class="code hl_enumeration" href="namespacemim_1_1plug_1_1core.html#a0d0bff4d75f3e06365643c56fd4672ef">wrap</a> = <a class="code hl_function" href="classmim_1_1Axm.html#ae8e87ce6a825b04d1f8ef741392cf353">Axm::as&lt;core::wrap&gt;</a>(def);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// def must match as a core::wrap::add - otherwise, asserts</span></div>
<div class="line">    <span class="keyword">auto</span> <a class="code hl_enumeration" href="namespacemim_1_1plug_1_1autodiff.html#adec076a151d709a29626cbe2a3c20337">add</a> = <a class="code hl_function" href="classmim_1_1Axm.html#ae8e87ce6a825b04d1f8ef741392cf353">Axm::as</a>(<a class="code hl_enumvalue" href="namespacemim_1_1plug_1_1core.html#a0d0bff4d75f3e06365643c56fd4672efa34ec78fcc91ffb1e54cd85e4a0924332">core::wrap::add</a>, def);</div>
<div class="line">}</div>
<div class="ttc" id="anamespacemim_1_1plug_1_1autodiff_html_adec076a151d709a29626cbe2a3c20337"><div class="ttname"><a href="namespacemim_1_1plug_1_1autodiff.html#adec076a151d709a29626cbe2a3c20337">mim::plug::autodiff::add</a></div><div class="ttdeci">add</div><div class="ttdef"><b>Definition</b> <a href="autodiff_2autogen_8h_source.html#l00046">autogen.h:46</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_1_1core_html_a0d0bff4d75f3e06365643c56fd4672ef"><div class="ttname"><a href="namespacemim_1_1plug_1_1core.html#a0d0bff4d75f3e06365643c56fd4672ef">mim::plug::core::wrap</a></div><div class="ttdeci">wrap</div><div class="ttdef"><b>Definition</b> <a href="core_2autogen_8h_source.html#l00135">autogen.h:135</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_1_1core_html_a0d0bff4d75f3e06365643c56fd4672efa34ec78fcc91ffb1e54cd85e4a0924332"><div class="ttname"><a href="namespacemim_1_1plug_1_1core.html#a0d0bff4d75f3e06365643c56fd4672efa34ec78fcc91ffb1e54cd85e4a0924332">mim::plug::core::wrap::add</a></div><div class="ttdeci">@ add</div><div class="ttdef"><b>Definition</b> <a href="core_2autogen_8h_source.html#l00136">autogen.h:136</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_1_1core_html_a0d0bff4d75f3e06365643c56fd4672efa353942263d1bedfbe06b7bfa78226253"><div class="ttname"><a href="namespacemim_1_1plug_1_1core.html#a0d0bff4d75f3e06365643c56fd4672efa353942263d1bedfbe06b7bfa78226253">mim::plug::core::wrap::mul</a></div><div class="ttdeci">@ mul</div><div class="ttdef"><b>Definition</b> <a href="core_2autogen_8h_source.html#l00138">autogen.h:138</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_1_1core_html_a0d0bff4d75f3e06365643c56fd4672efa8a68dc3e925eacf92633be230722a140"><div class="ttname"><a href="namespacemim_1_1plug_1_1core.html#a0d0bff4d75f3e06365643c56fd4672efa8a68dc3e925eacf92633be230722a140">mim::plug::core::wrap::sub</a></div><div class="ttdeci">@ sub</div><div class="ttdef"><b>Definition</b> <a href="core_2autogen_8h_source.html#l00137">autogen.h:137</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_1_1core_html_a0d0bff4d75f3e06365643c56fd4672efabc192716b0e1d5c96a67961dd0d3f9da"><div class="ttname"><a href="namespacemim_1_1plug_1_1core.html#a0d0bff4d75f3e06365643c56fd4672efabc192716b0e1d5c96a67961dd0d3f9da">mim::plug::core::wrap::shl</a></div><div class="ttdeci">@ shl</div><div class="ttdef"><b>Definition</b> <a href="core_2autogen_8h_source.html#l00139">autogen.h:139</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_1_1core_html_a24bcda8cb32531a8a5b3d5ab6d6c707e"><div class="ttname"><a href="namespacemim_1_1plug_1_1core.html#a24bcda8cb32531a8a5b3d5ab6d6c707e">mim::plug::core::mode</a></div><div class="ttdeci">mode</div><div class="ttdef"><b>Definition</b> <a href="core_2autogen_8h_source.html#l00053">autogen.h:53</a></div></div>
<div class="ttc" id="anamespacemim_1_1plug_1_1core_html_aa277dfbcc34fa69c6e62d136815f3e43a0cc175b9c0f1b6a831c399e269772661"><div class="ttname"><a href="namespacemim_1_1plug_1_1core.html#aa277dfbcc34fa69c6e62d136815f3e43a0cc175b9c0f1b6a831c399e269772661">mim::plug::core::shr::a</a></div><div class="ttdeci">@ a</div><div class="ttdef"><b>Definition</b> <a href="core_2autogen_8h_source.html#l00124">autogen.h:124</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md26"></a>
Summary</h3>
<p>The following table summarizes all important casts:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><code>dynamic_cast</code> <br  />
 <code>static_cast</code>   </th><th class="markdownTableHeadNone">Returns   </th><th class="markdownTableHeadNone">If <code>def</code> is a ...    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>isa&lt;mem::load&gt;(def)</code> <br  />
 <code>as&lt;mem::load&gt;(def)</code>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Axm_1_1IsA.html">mim::Axm::IsA</a><code>&lt;</code><a class="el" href="namespacemim_1_1plug_1_1mem.html#a029144aa6e194281070cc4406fe2268e">mem::load</a>, <a class="el" href="classmim_1_1App.html">App</a><code>&gt;</code>   </td><td class="markdownTableBodyNone"><code>%mem.load (T, as) (mem, ptr)</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>isa&lt;core::wrap&gt;(def)</code> <br  />
 <code>as&lt;core::wrap&gt;(def)</code>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Axm_1_1IsA.html">mim::Axm::IsA</a><code>&lt;</code><a class="el" href="namespacemim_1_1plug_1_1mem.html#a029144aa6e194281070cc4406fe2268e">core::wrap</a>, <a class="el" href="classmim_1_1App.html">App</a><code>&gt;</code>   </td><td class="markdownTableBodyNone"><code>%core.wrap.??? s m (a, b)</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>isa(core::wrap::add, def)</code> <br  />
 <code>as(core::wrap::add, def)</code>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Axm_1_1IsA.html">mim::Axm::IsA</a><code>&lt;</code><a class="el" href="namespacemim_1_1plug_1_1mem.html#a029144aa6e194281070cc4406fe2268e">core::wrap</a>, <a class="el" href="classmim_1_1App.html">App</a><code>&gt;</code>   </td><td class="markdownTableBodyNone"><code>%core.wrap.add s m (a, b)</code>   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md27"></a>
Working with Indices</h1>
<p>There are essentially <b>three</b> ways of retrieving the number of elements of something in MimIR.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
Arity</h2>
<p>This is the number of elements of to <a class="el" href="classmim_1_1Extract.html">extract</a>/<a class="el" href="classmim_1_1Insert.html">insert</a> a single element. Note that the number of elements may be unknown at compile time such as in <code>n; 0</code>.</p>
<h2><a class="anchor" id="autotoc_md29"></a>
Proj</h2>
<p><a class="el" href="classmim_1_1Def.html#ad531ece40a890922a7deb83e3d8de8ea" title="Yields Def::as_lit_arity(), if it is in fact a Lit, or 1 otherwise.">mim::Def::num_projs</a> is the same as <a class="el" href="classmim_1_1Def.html#ae51857d275509b1b70aa8f696cee3a0a">mim::Def::arity</a>, if the arity is a <a class="el" href="classmim_1_1Lit.html">mim::Lit</a>. Otherwise, it is simply <code>1</code>. This concept only exists in the C++-API to give the programmer the illusion to work with n-ary functions, e.g.:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> dom : pi-&gt;doms()) { <span class="comment">/*...*/</span> }</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> var : lam-&gt;vars()) { <span class="comment">/*...*/</span> }</div>
</div><!-- fragment --><p>But in reality, all functions have exactly one domain and one codomain.</p>
<h3><a class="anchor" id="autotoc_md30"></a>
Thresholded Variants</h3>
<p>In additition, there are thresholded variants available that are prefixed with a <code>t</code> and take <a class="el" href="namespacemim.html#a39f92287adf5cb956f0696a740ba3fe7">mim::Flags::scalarize_threshold</a> (<code>--scalarize-threshold</code>) into account. The method <a class="el" href="classmim_1_1Def.html#a26e88f05b40da602dbc2d3cfc02e4799" title="As above but yields 1, if Flags::scalarize_threshold is exceeded.">mim::Def::num_tprojs</a> returns the same as <a class="el" href="classmim_1_1Def.html#ad531ece40a890922a7deb83e3d8de8ea" title="Yields Def::as_lit_arity(), if it is in fact a Lit, or 1 otherwise.">mim::Def::num_projs</a>, but will simply yield <code>1</code>, if the arity exceeds the threshold. <a class="el" href="classmim_1_1Def.html#af6e7198e0e73e05007e24750b1286810" title="As above but takes Def::num_tprojs.">mim::Def::tproj</a>, <a class="el" href="classmim_1_1Def.html#abeef2032ba9550fe86fab107d607a2fb">mim::Def::tprojs</a>, <a class="el" href="classmim_1_1Def.html#ac95a7f21e315be2ff334356a86a3b97f">mim::Lam::tvars</a>, etc. work accordingly.</p>
<p><b>See also:</b></p>
<ul>
<li><a class="el" href="classmim_1_1Def.html#proj">Def::proj</a></li>
<li><a class="el" href="classmim_1_1Def.html#var">Def::var</a></li>
<li><a class="el" href="classmim_1_1Pi.html#pi_dom">Pi::dom</a></li>
<li><a class="el" href="classmim_1_1Lam.html#lam_dom">Lam::dom</a></li>
<li><a class="el" href="classmim_1_1App.html#app_arg">App::arg</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md31"></a>
Shape</h2>
<p>TODO</p>
<h2><a class="anchor" id="autotoc_md32"></a>
Summary</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Expression   </th><th class="markdownTableHeadNone">Class   </th><th class="markdownTableHeadNone"><a class="el" href="classmim_1_1Def.html#ae51857d275509b1b70aa8f696cee3a0a">artiy</a>   </th><th class="markdownTableHeadNone"><a class="el" href="classmim_1_1Def.html#ad556c5c2c74abd4f5b739fcb8e5221ed">isa_lit_artiy</a>   </th><th class="markdownTableHeadNone"><a class="el" href="classmim_1_1Def.html#a2a11678fe06e85f99174197c674124e0">as_lit_artiy</a>   </th><th class="markdownTableHeadNone"><a class="el" href="classmim_1_1Def.html#ad531ece40a890922a7deb83e3d8de8ea">num_projs</a>   </th><th class="markdownTableHeadNone"><a class="el" href="classmim_1_1Def.html#a26e88f05b40da602dbc2d3cfc02e4799">num_tprojs</a>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>(0, 1, 2)</code>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Tuple.html">Tuple</a>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>3; 0</code>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Pack.html">Pack</a>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>n; 0</code>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Pack.html">Pack</a>   </td><td class="markdownTableBodyNone"><code>n</code>   </td><td class="markdownTableBodyNone"><code>std::nullopt</code>   </td><td class="markdownTableBodyNone">asserts   </td><td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone"><code>1</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>[Nat, Bool, Nat]</code>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Sigma.html">Sigma</a>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>3; Nat</code>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Arr.html">Arr</a>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>   </td><td class="markdownTableBodyNone"><code>3</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>n; Nat</code>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Arr.html">Arr</a>   </td><td class="markdownTableBodyNone"><code>n</code>   </td><td class="markdownTableBodyNone"><code>std::nullopt</code>   </td><td class="markdownTableBodyNone">asserts   </td><td class="markdownTableBodyNone"><code>1</code>   </td><td class="markdownTableBodyNone"><code>1</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>x: [Nat, Bool]</code>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Var.html">Var</a>   </td><td class="markdownTableBodyNone"><code>2</code>   </td><td class="markdownTableBodyNone"><code>2</code>   </td><td class="markdownTableBodyNone"><code>2</code>   </td><td class="markdownTableBodyNone"><code>2</code>   </td><td class="markdownTableBodyNone"><code>2</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>32; 0</code>   </td><td class="markdownTableBodyNone"><a class="el" href="classmim_1_1Pack.html">Pack</a>   </td><td class="markdownTableBodyNone"><code>32</code>   </td><td class="markdownTableBodyNone"><code>32</code>   </td><td class="markdownTableBodyNone"><code>32</code>   </td><td class="markdownTableBodyNone"><code>32</code>   </td><td class="markdownTableBodyNone"><code>1</code>   </td></tr>
</table>
<p>The last line assumes <a class="el" href="namespacemim.html#a39f92287adf5cb956f0696a740ba3fe7">mim::Flags::scalarize_threshold</a> = 32.</p>
<h1><a class="anchor" id="autotoc_md33"></a>
Iterating over the Program</h1>
<p>There are several ways of doing this. It depends on what exactly you want to achieve and how much structure you need during the traversal. The simplest way is to kick off with <a class="el" href="classmim_1_1World.html#a9f1dafe6dd69d4a63ad6f883c9194872">World::externals</a> and recursively run over <a class="el" href="classmim_1_1Def.html#a20e9e09e55fc9b46a6f74423f2c5d35d">Def::deps</a> like this:</p>
<div class="fragment"><div class="line"><a class="code hl_typedef" href="namespacemim.html#aa55cde5ad8246840d0a046cc728f987d">DefSet</a> done;</div>
<div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> mut : world.externals())</div>
<div class="line">    <a class="code hl_function" href="namespacemim.html#a01df1c711f47326f6d3b9efc933ccd26">visit</a>(done, mut);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="namespacemim.html#a01df1c711f47326f6d3b9efc933ccd26">visit</a>(<a class="code hl_typedef" href="namespacemim.html#aa55cde5ad8246840d0a046cc728f987d">DefSet</a>&amp; done, <span class="keyword">const</span> <a class="code hl_class" href="classmim_1_1Def.html">Def</a>* def) {</div>
<div class="line">    <span class="keywordflow">if</span> (!done.emplace(def).second) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    do_sth(def);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> op : def-&gt;<a class="code hl_function" href="classmim_1_1Def.html#a20e9e09e55fc9b46a6f74423f2c5d35d">deps</a>()) <a class="code hl_function" href="namespacemim.html#a01df1c711f47326f6d3b9efc933ccd26">visit</a>(done, op);</div>
<div class="line">}</div>
<div class="ttc" id="aclassmim_1_1Def_html_a20e9e09e55fc9b46a6f74423f2c5d35d"><div class="ttname"><a href="classmim_1_1Def.html#a20e9e09e55fc9b46a6f74423f2c5d35d">mim::Def::deps</a></div><div class="ttdeci">Defs deps() const noexcept</div><div class="ttdef"><b>Definition</b> <a href="def_8cpp_source.html#l00410">def.cpp:410</a></div></div>
<div class="ttc" id="anamespacemim_html_a01df1c711f47326f6d3b9efc933ccd26"><div class="ttname"><a href="namespacemim.html#a01df1c711f47326f6d3b9efc933ccd26">mim::visit</a></div><div class="ttdeci">bool visit(IndexSet&lt; Indexer, Key &gt; &amp;set, const Key &amp;key)</div><div class="ttdef"><b>Definition</b> <a href="indexset_8h_source.html#l00095">indexset.h:95</a></div></div>
<div class="ttc" id="anamespacemim_html_aa55cde5ad8246840d0a046cc728f987d"><div class="ttname"><a href="namespacemim.html#aa55cde5ad8246840d0a046cc728f987d">mim::DefSet</a></div><div class="ttdeci">GIDSet&lt; const Def * &gt; DefSet</div><div class="ttdef"><b>Definition</b> <a href="def_8h_source.html#l00047">def.h:47</a></div></div>
</div><!-- fragment --><p>However, you will most likely want to use the <a class="el" href="passes.html#md_docs_2passes">pass</a> or the phase infrastructure. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
