<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Thorin: The compile Plugin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-interactive-toc.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
    DoxygenAwesomeFragmentCopyButton.init()
    DoxygenAwesomeInteractiveToc.init()
    DoxygenAwesomeParagraphLink.init()
</script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-interactive-toc.js" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/anydsl/thorin2" class="github-corner" title="View source on GitHub">
    <svg viewBox="0 0 250 250" style="position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Thorin<span id="projectnumber">&#160;1.9.0</span>
   </div>
   <div id="projectbrief">The Higher ORder INtermediate representation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('compile.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">The compile Plugin </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md92">Types</a><ul><li class="level2"><a href="#autotoc_md93">%compile.Pass</a></li>
<li class="level2"><a href="#autotoc_md94">%compile.Phase</a></li>
<li class="level2"><a href="#autotoc_md95">%compile.Pipeline</a></li>
<li class="level2"><a href="#autotoc_md96">%compile.PassList</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md97">Expressions</a><ul><li class="level2"><a href="#autotoc_md98">Registered Plugins</a></li>
<li class="level2"><a href="#autotoc_md99">%opt.is_loaded</a></li>
<li class="level2"><a href="#autotoc_md100">%compile.pipe</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md101">Passes and Phases</a><ul><li class="level2"><a href="#autotoc_md102">%compile.debug_phase</a></li>
<li class="level2"><a href="#autotoc_md103">%compile.pass_phase</a></li>
<li class="level2"><a href="#autotoc_md104">%compile.combined_phase</a></li>
<li class="level2"><a href="#autotoc_md105">Passes</a></li>
<li class="level2"><a href="#autotoc_md106">Phases</a></li>
<li class="level2"><a href="#autotoc_md107">Pipelines</a></li>
<li class="level2"><a href="#autotoc_md108">Dependent Passes and Phases</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_build_docs_dialects_compile"></a> </p><dl class="section see"><dt>See also</dt><dd><a class="el" href="namespacethorin_1_1compile.html" title="The compile Plugin">thorin::compile</a></dd></dl>
<p>This plugin handles the optimization part of the compilation of Thorin programs. Plugins can register passes and phases using the axioms from this plugin. The program then can invoke the optimization pipeline by defining a function <code>_compile: [] -&gt; compile.Pipeline</code>.</p>
<h1><a class="anchor" id="autotoc_md92"></a>
Types</h1>
<h2><a class="anchor" id="autotoc_md93"></a>
%compile.Pass</h2>
<h2><a class="anchor" id="autotoc_md94"></a>
%compile.Phase</h2>
<p >Types for compilation passes and phases.</p>
<div class="fragment"><div class="line">.ax %compile.Pass:  *;</div>
<div class="line">.ax %compile.Phase: *;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md95"></a>
%compile.Pipeline</h2>
<h2><a class="anchor" id="autotoc_md96"></a>
%compile.PassList</h2>
<p >Types for functions that accept an arbitrary number of phases and passes respectively.</p>
<div class="fragment"><div class="line">.Pi %compile.Pipeline:      □ = Π %compile.Phase -&gt; %compile.Pipeline;</div>
<div class="line">.Pi %compile.PassList:      □ = Π %compile.Pass  -&gt; %compile.PassList;</div>
<div class="line">.Pi %compile.CombinedPhase: □ = Π %compile.Phase -&gt; %compile.CombinedPhase;</div>
</div><!-- fragment --><p >(This is a forward declaration for opt.thorin.)</p>
<div class="fragment"><div class="line">.ax %compile.Plugin: *;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md97"></a>
Expressions</h1>
<h2><a class="anchor" id="autotoc_md98"></a>
Registered Plugins</h2>
<p >We expect the name in the tag before the <code>_</code> to be the name of the plugin (as given in <code>Plugin.plugin_name</code>). (This is a forward declaration for opt.thorin.)</p>
<div class="fragment"><div class="line">.ax %compile.core_plugin    : %compile.Plugin;</div>
<div class="line">.ax %compile.mem_plugin     : %compile.Plugin;</div>
<div class="line">.ax %compile.demo_plugin    : %compile.Plugin;</div>
<div class="line">.ax %compile.affine_plugin  : %compile.Plugin;</div>
<div class="line">.ax %compile.autodiff_plugin: %compile.Plugin;</div>
<div class="line">.ax %compile.clos_plugin    : %compile.Plugin;</div>
<div class="line">.ax %compile.direct_plugin  : %compile.Plugin;</div>
<div class="line">.ax %compile.refly_plugin   : %compile.Plugin;</div>
<div class="line">.ax %compile.regex_plugin   : %compile.Plugin;</div>
<div class="line">.ax %compile.matrix_plugin  : %compile.Plugin;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md99"></a>
%opt.is_loaded</h2>
<p >Indicates whether a plugin is loaded. The normalizer will statically evaluate this expression to a constant boolean. TODO: find correct point (not at parsing but before compilation)</p>
<div class="fragment"><div class="line">// .ax %opt.is_loaded: %opt.Plugin -&gt; .Bool;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md100"></a>
%compile.pipe</h2>
<p >Given n phases, returns the representation of a pipeline.</p>
<div class="fragment"><div class="line">.ax %compile.pipe: %compile.Pipeline;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md101"></a>
Passes and Phases</h1>
<h2><a class="anchor" id="autotoc_md102"></a>
%compile.debug_phase</h2>
<p >Given a log level, returns a phase that prints the externals (for log level &gt;= 2).</p>
<div class="fragment"><div class="line">.ax %compile.debug_phase: .Nat -&gt; %compile.Phase;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md103"></a>
%compile.pass_phase</h2>
<p >Given n passes, returns a phase that applies them in order.</p>
<p >TODO: combine two pass_list </p><div class="fragment"><div class="line">.ax %compile.pass_list: %compile.PassList;</div>
</div><!-- fragment --><p> <code>pass_phase (pass_list pass1 ... passN) = passes_to_phase N (pass1, ..., passN)</code> </p><div class="fragment"><div class="line">.ax %compile.pass_phase: %compile.PassList -&gt; %compile.Phase, normalize_pass_phase;</div>
<div class="line">.ax %compile.passes_to_phase: Π [n:.Nat] -&gt; «n; %compile.Pass» -&gt; %compile.Phase;</div>
</div><!-- fragment --><p> <code>combine_pass_list K (pass_list pass11 ... pass1N) ... (pass_list passK1 ... passKM) = pass_list pass11 ... p1N ... passK1 ... passKM</code> </p><div class="fragment"><div class="line">.ax %compile.combine_pass_list: Π [n:.Nat] -&gt; «n; %compile.PassList» -&gt; %compile.PassList, normalize_combine_pass_list;</div>
</div><!-- fragment --><p> <code>single_pass_phase pass = passes_to_phase 1 pass</code> </p><div class="fragment"><div class="line">// TODO: as let instead of axiom</div>
<div class="line">.ax %compile.single_pass_phase: %compile.Pass -&gt; %compile.Phase, normalize_single_pass_phase;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md104"></a>
%compile.combined_phase</h2>
<p >Given n phases, returns a phase that applies them in order.</p>
<div class="fragment"><div class="line">.ax %compile.phase_list: %compile.CombinedPhase;</div>
</div><!-- fragment --><p> <code>combined_phase (phase_list phase1 ... phaseN) = phases_to_phase N (phase1, ..., phaseN)</code> </p><div class="fragment"><div class="line">.ax %compile.combined_phase: %compile.CombinedPhase -&gt; %compile.Phase, normalize_combined_phase;</div>
<div class="line">.ax %compile.phases_to_phase: Π [n:.Nat] -&gt; «n; %compile.Phase» -&gt; %compile.Phase;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md105"></a>
Passes</h2>
<p >Basic passes that are defined in the core of Thorin.</p>
<div class="fragment"><div class="line">.ax %compile.beta_red_pass: %compile.Pass;</div>
<div class="line">.ax %compile.eta_red_pass: %compile.Pass;</div>
</div><!-- fragment --><p> Eta expansion expects an instance of eta reduction as argument. </p><div class="fragment"><div class="line">.ax %compile.eta_exp_pass: %compile.Pass -&gt; %compile.Pass;</div>
</div><!-- fragment --><p> Scalerize expects an instance of eta expansion as argument. </p><div class="fragment"><div class="line">.ax %compile.scalerize_pass: %compile.Pass -&gt; %compile.Pass;</div>
</div><!-- fragment --><p> Tail recursion elimination expects an instance of eta reduction as argument. </p><div class="fragment"><div class="line">.ax %compile.tail_rec_elim_pass: %compile.Pass -&gt; %compile.Pass;</div>
<div class="line">.ax %compile.lam_spec_pass: %compile.Pass;</div>
<div class="line">.ax %compile.ret_wrap_pass: %compile.Pass;</div>
</div><!-- fragment --><p> has to be registered in the pipeline </p><div class="fragment"><div class="line">.ax %compile.nullptr_pass: %compile.Pass;</div>
<div class="line">.ax %compile.internal_cleanup_pass: %compile.Pass;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md106"></a>
Phases</h2>
<div class="fragment"><div class="line">// TODO: allow functions by inlining them first</div>
<div class="line">.let optimization_pass_list = {</div>
<div class="line">    .let eta_red = %compile.eta_red_pass;</div>
<div class="line">    .let eta_exp = %compile.eta_exp_pass eta_red;</div>
<div class="line">    %compile.pass_list</div>
<div class="line">        %compile.beta_red_pass</div>
<div class="line">        eta_red</div>
<div class="line">        eta_exp</div>
<div class="line">        (%compile.scalerize_pass eta_exp)</div>
<div class="line">        (%compile.tail_rec_elim_pass eta_red)</div>
<div class="line">};</div>
<div class="line">.let optimization_phase = {</div>
<div class="line">    %compile.pass_phase optimization_pass_list</div>
<div class="line">};</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md107"></a>
Pipelines</h2>
<div class="fragment"><div class="line">.let default_core_pipeline = {</div>
<div class="line">    .let nullptr = %compile.nullptr_pass;</div>
<div class="line">    %compile.pipe</div>
<div class="line">        (%compile.single_pass_phase nullptr)</div>
<div class="line">        (%compile.single_pass_phase (%compile.scalerize_pass nullptr))</div>
<div class="line">        (%compile.single_pass_phase %compile.eta_red_pass)</div>
<div class="line">        (%compile.single_pass_phase (%compile.tail_rec_elim_pass nullptr))</div>
<div class="line">        optimization_phase</div>
<div class="line">        (%compile.single_pass_phase %compile.internal_cleanup_pass)</div>
<div class="line">        (%compile.single_pass_phase %compile.lam_spec_pass)</div>
<div class="line">        (%compile.single_pass_phase %compile.ret_wrap_pass)</div>
<div class="line">};</div>
<div class="line">.lam .extern _fallback_compile(): %compile.Pipeline = default_core_pipeline;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md108"></a>
Dependent Passes and Phases</h2>
<div class="fragment"><div class="line">.let empty_pass = %compile.nullptr_pass;</div>
<div class="line">.let empty_phase = %compile.passes_to_phase 0 ();</div>
<div class="line">.ax %compile.plugin_select: Π [T:*] -&gt; %compile.Plugin -&gt; T -&gt; T -&gt; T;</div>
<div class="line">.let plugin_phase = %compile.plugin_select %compile.Phase;</div>
<div class="line">.let plugin_pass = %compile.plugin_select %compile.Pass;</div>
<div class="line">.lam plugin_cond_phase(plugin: %compile.Plugin, phase: %compile.Phase): %compile.Phase = plugin_phase plugin phase empty_phase;</div>
<div class="line">.lam plugin_cond_pass(plugin: %compile.Plugin, pass: %compile.Pass): %compile.Pass = plugin_pass plugin pass empty_pass;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
